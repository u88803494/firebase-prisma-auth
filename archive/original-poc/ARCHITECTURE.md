# ğŸ—ï¸ ç³»çµ±æ¶æ§‹è©³è¨­

> æœ€å¾Œæ›´æ–°ï¼š2025-11-18
> ç‰ˆæœ¬ï¼š1.0.0

## ğŸ“Œ æ¶æ§‹æ¦‚è¦½

### é«˜å±¤è¨­è¨ˆåœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  User Browser                          â”‚
â”‚  (Chrome, Safari, Firefox, Mobile)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Next.js App     â”‚
                â”‚  (Frontend)      â”‚
                â”‚                  â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚ â”‚ Login UI     â”‚ â”‚
                â”‚ â”‚ Register UI  â”‚ â”‚
                â”‚ â”‚ Home Page    â”‚ â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚        â”‚         â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚ â”‚ Firebase     â”‚ â”‚
                â”‚ â”‚ Client SDK   â”‚ â”‚
                â”‚ â”‚ (èªè­‰)       â”‚ â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚        â”‚         â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                â”‚ â”‚ State Mgmt    â”‚â”‚
                â”‚ â”‚ (Zustand)     â”‚â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                â”‚        â”‚         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Firebase Token
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    Firebase             â”‚
                â”‚  (Google Cloud)         â”‚
                â”‚                         â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚ â”‚ Authentication     â”‚ â”‚
                â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                â”‚ â”‚ â€¢ Email/Password   â”‚ â”‚
                â”‚ â”‚ â€¢ Phone (SMS OTP)  â”‚ â”‚
                â”‚ â”‚ â€¢ OAuth (Google)   â”‚ â”‚
                â”‚ â”‚ â€¢ OAuth (Facebook) â”‚ â”‚
                â”‚ â”‚ â€¢ OAuth (LINE)     â”‚ â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚          â”‚ ID Token    â”‚
                â”‚          â”‚ (1 hour)    â”‚
                â”‚          â”‚             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Next.js Backend       â”‚
                â”‚   (API Routes)          â”‚
                â”‚                         â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                â”‚ â”‚ /api/auth/*       â”‚  â”‚
                â”‚ â”‚ â€¢ POST /login     â”‚  â”‚
                â”‚ â”‚ â€¢ POST /register  â”‚  â”‚
                â”‚ â”‚ â€¢ POST /verify    â”‚  â”‚
                â”‚ â”‚ â€¢ POST /logout    â”‚  â”‚
                â”‚ â”‚ â€¢ GET  /me        â”‚  â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚          â”‚             â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                â”‚ â”‚ Firebase Admin    â”‚  â”‚
                â”‚ â”‚ SDK               â”‚  â”‚
                â”‚ â”‚ (é©—è­‰ Token)      â”‚  â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚          â”‚             â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                â”‚ â”‚ Prisma ORM        â”‚  â”‚
                â”‚ â”‚ (è³‡æ–™å±¤)          â”‚  â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                â”‚          â”‚             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    SQLite ğŸ—„ï¸         â”‚
                â”‚                     â”‚
                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚ â”‚ users table     â”‚ â”‚
                â”‚ â”‚ userAuth table  â”‚ â”‚
                â”‚ â”‚ phoneToEmail    â”‚ â”‚
                â”‚ â”‚ table           â”‚ â”‚
                â”‚ â”‚                 â”‚ â”‚
                â”‚ â”‚ (dev.db)        â”‚ â”‚
                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚                     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ¶æ§‹å±¤æ¬¡

### Layer 1ï¼šå‰ç«¯å±¤ï¼ˆFrontendï¼‰

**ä½ç½®**ï¼š`src/app/` + `src/components/`

**è²¬ä»»**ï¼š
- ç”¨æˆ¶ä»‹é¢å’Œäº¤äº’
- Firebase èªè­‰
- æœ¬åœ°ç‹€æ…‹ç®¡ç†
- èˆ‡å¾Œç«¯é€šä¿¡

**ä¸»è¦çµ„ä»¶**ï¼š
```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ login/          # ç™»å…¥é é¢
â”‚   â”œâ”€â”€ register/       # è¨»å†Šé é¢
â”‚   â”œâ”€â”€ dashboard/      # å—ä¿è­·é é¢
â”‚   â””â”€â”€ layout.tsx      # å…¨å±€å¸ƒå±€
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”œâ”€â”€ OAuthButtons.tsx
â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ firebase.ts     # Firebase åˆå§‹åŒ–
â”‚   â”œâ”€â”€ auth.ts         # èªè­‰å‡½æ•¸
â”‚   â””â”€â”€ api.ts          # API å®¢æˆ¶ç«¯
â”‚
â””â”€â”€ store/
    â””â”€â”€ authStore.ts    # Zustand store
```

### Layer 2ï¼šèªè­‰å±¤ï¼ˆAuthenticationï¼‰

**æä¾›å•†**ï¼šFirebase Authentication

**è²¬ä»»**ï¼š
- å®‰å…¨å­˜å„²å¯†ç¢¼ï¼ˆé›œæ¹Šï¼‰
- ç®¡ç†ç”¨æˆ¶èº«ä»½ï¼ˆuidï¼‰
- ç°½ç™¼ ID Token
- æ”¯æŒå¤šç¨®ç™»å…¥æ–¹å¼

**ç‰¹é»**ï¼š
```
âœ… å®‰å…¨
   - å¯†ç¢¼è¢«é›œæ¹Šï¼Œç„¡æ³•å–å¾—æ˜æ–‡
   - HTTPS åŠ å¯†å‚³è¼¸
   - Google è¨—ç®¡ï¼Œ99.99% å¯ç”¨æ€§

âœ… æ”¯æŒå¤šç¨®èªè­‰
   - Email/Password
   - Phone (SMS)
   - OAuth (Google, Facebook, LINE)

âœ… Token ç®¡ç†
   - ID Tokenï¼ˆ1 å°æ™‚æœ‰æ•ˆæœŸï¼‰
   - Refresh Tokenï¼ˆè‡ªå‹•åˆ·æ–°ï¼‰
```

### Layer 3ï¼šå¾Œç«¯å±¤ï¼ˆBackendï¼‰

**ä½ç½®**ï¼š`src/app/api/`

**è²¬ä»»**ï¼š
- é©—è­‰ Firebase Token
- å­˜å–è³‡æ–™åº«
- æ¥­å‹™é‚è¼¯è™•ç†
- ç”¨æˆ¶è³‡æ–™ç®¡ç†

**ä¸»è¦ API**ï¼š
```typescript
POST /api/auth/login         # æ‰‹æ©Ÿâ†’Email è½‰æ›
POST /api/auth/register      # è¨»å†Šæ–°ç”¨æˆ¶
POST /api/auth/verify-token  # é©—è­‰ Token
GET  /api/auth/me            # å–å¾—ç•¶å‰ç”¨æˆ¶
POST /api/auth/logout        # ç™»å‡º
```

### Layer 4ï¼šè³‡æ–™å±¤ï¼ˆDatabaseï¼‰

**æä¾›å•†**ï¼šSQLiteï¼ˆé–‹ç™¼ï¼‰/ PostgreSQLï¼ˆç”Ÿç”¢ï¼‰

**è²¬ä»»**ï¼š
- æŒä¹…åŒ–ç”¨æˆ¶è³‡æ–™
- æ”¯æŒå¿«é€ŸæŸ¥è©¢
- ç¢ºä¿è³‡æ–™å®Œæ•´æ€§

**è¨­è¨ˆ**ï¼š
```
users è¡¨
â”œâ”€ Firebase UID
â”œâ”€ Email
â”œâ”€ Phone Number
â”œâ”€ Display Name
â””â”€ ç™»å…¥æ–¹å¼

userAuth è¡¨
â”œâ”€ èªè­‰è©³æƒ…
â”œâ”€ OAuth ç¶å®š
â””â”€ é©—è­‰ç‹€æ…‹

phoneToEmail è¡¨
â””â”€ å¿«é€Ÿæ˜ å°„æŸ¥è©¢
```

---

## ğŸ”„ èªè­‰æµç¨‹ï¼ˆè©³ç´°ï¼‰

### æ‰‹æ©Ÿ + å¯†ç¢¼ç™»å…¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ¶è¼¸å…¥   â”‚
â”‚ æ‰‹æ©Ÿ + å¯†ç¢¼ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend é©—è­‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ‰‹æ©Ÿæ ¼å¼æª¢æŸ¥       â”‚
â”‚ â€¢ å¯†ç¢¼å¼·åº¦æª¢æŸ¥       â”‚
â”‚ â€¢ æœ¬åœ°é©—è­‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/login     â”‚
â”‚ { phone, password }      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend é‚è¼¯             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æŸ¥è©¢ phoneToEmail     â”‚
â”‚    æ‰¾åˆ°å°æ‡‰çš„ Email      â”‚
â”‚ 2. é©—è­‰å¯†ç¢¼æ­£ç¢ºæ€§        â”‚
â”‚    (é€é Firebase)       â”‚
â”‚ 3. å›å‚³ Email            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ Email
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Firebase Login â”‚
â”‚ signInWithEmailAndPassword
â”‚ (email, password)        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase é©—è­‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æª¢æŸ¥ Email å’Œå¯†ç¢¼       â”‚
â”‚ â€¢ ç°½ç™¼ ID Token (1hr)    â”‚
â”‚ â€¢ ç°½ç™¼ Refresh Token     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Token
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/verify    â”‚
â”‚ Authorization: Bearer... â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend é©—è­‰ + æ›´æ–°è³‡æ–™  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç”¨ Admin SDK é©—è­‰     â”‚
â”‚ 2. æŸ¥è©¢ Prisma å–å¾—è³‡æ–™  â”‚
â”‚ 3. å›å‚³ä½¿ç”¨è€…è³‡è¨Š        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ä½¿ç”¨è€…è³‡è¨Š
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™»å…¥å®Œæˆï¼       â”‚
â”‚ é‡å®šå‘é¦–é        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OAuth ç™»å…¥ï¼ˆGoogle/Facebookï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ¶é»æ“Š     â”‚
â”‚ Google æŒ‰éˆ•  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Popup     â”‚
â”‚ signInWithPopup    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google OAuth Page  â”‚
â”‚ ä½¿ç”¨è€…æˆæ¬Š         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase å›å‚³            â”‚
â”‚ UserCredential + Token   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend æª¢æŸ¥ç”¨æˆ¶å­˜åœ¨    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·²å­˜åœ¨ â†’ ç›´æ¥ç™»å…¥å®Œæˆ    â”‚
â”‚ ä¸å­˜åœ¨ â†’ å»ºç«‹å¸³è™Ÿ        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (å¦‚æœæ–°ç”¨æˆ¶)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/register  â”‚
â”‚ å»ºç«‹ç”¨æˆ¶è³‡æ–™             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™»å…¥å®Œæˆï¼       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ å®‰å…¨è¨­è¨ˆ

### Authentication Flow

```
å‰ç«¯ (Browser)          å¾Œç«¯ (Node.js)

ç™¼é€ Token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
                      é©—è­‰ Token
                      (Admin SDK)
                      â”‚
                      å¦‚æœæœ‰æ•ˆ â—€â”€ æŸ¥è©¢è³‡æ–™åº«
                      â”‚
                â—€â”€â”€â”€â”€ å›å‚³ä½¿ç”¨è€…è³‡è¨Š
ä¿å­˜ Session
```

### Token ç”Ÿå‘½é€±æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID Token (1 hour)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æ–¼ API é©—è­‰            â”‚
â”‚ â€¢ éæœŸå¾Œéœ€è¦åˆ·æ–°           â”‚
â”‚ â€¢ å­˜å„²åœ¨è¨˜æ†¶é«”ï¼ˆä¸ç”¨å„²å­˜ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Refresh Token (é•·æœŸ)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æ–¼ç²å¾—æ–° ID Token      â”‚
â”‚ â€¢ å­˜å„²åœ¨ httpOnly Cookie   â”‚
â”‚ â€¢ è‡ªå‹•åˆ·æ–°ï¼ˆå®¢æˆ¶ç«¯é€æ˜ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session (æœ¬åœ°)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å­˜å„²ç”¨æˆ¶åŸºæœ¬è³‡è¨Š         â”‚
â”‚ â€¢ Redux/Zustand Store      â”‚
â”‚ â€¢ ç™»å‡ºæ™‚æ¸…é™¤               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯†ç¢¼å®‰å…¨

```
ç”¨æˆ¶å¯†ç¢¼
   â”‚
   â–¼ (ç™¼é€åˆ° Firebase)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Hash          â”‚ (bcrypt)
â”‚ 2. Salt          â”‚ (éš¨æ©Ÿ)
â”‚ 3. å®‰å…¨å„²å­˜      â”‚ (Google ä¼ºæœå™¨)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çµæœï¼š
âœ… ç„¡æ³•æ¢å¾©å¯†ç¢¼
âœ… å…©å€‹ç›¸åŒå¯†ç¢¼çš„ hash ä¸åŒ
âœ… Admin SDK ç„¡æ³•è®€å–
```

---

## ğŸ“Š è³‡æ–™æµåœ–

### æ‰‹æ©Ÿåˆ° Email æ˜ å°„

```
è¼¸å…¥ï¼šæ‰‹æ©Ÿè™Ÿç¢¼ (0912345678)
   â”‚
   â–¼
æŸ¥è©¢ phoneToEmail è¡¨
   â”‚
   â”œâ”€ å­˜åœ¨ â†’ å›å‚³ Email
   â”‚        (user@example.com)
   â”‚
   â””â”€ ä¸å­˜åœ¨ â†’ éŒ¯èª¤
             (æ­¤æ‰‹æ©Ÿæœªè¨»å†Š)
```

### ç”¨æˆ¶è³‡æ–™æµ

```
Firebase Auth         SQLite
    â”‚                   â”‚
    â”œâ”€ uid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ users.uid (PK)
    â”œâ”€ email â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ users.email
    â”œâ”€ displayName â”€â”€â”€â”€â”€â–¶ users.displayName
    â”‚
    â””â”€ (OAuth info) â”€â”€â”€â”€â–¶ userAuth.oauthProviders
                           (JSON æ ¼å¼)
```

---

## ğŸš€ éƒ¨ç½²æ¶æ§‹

### é–‹ç™¼ç’°å¢ƒ

```
æœ¬åœ°é›»è…¦
â”œâ”€ Next.js Dev Server (localhost:3000)
â”œâ”€ SQLite (prisma/dev.db)
â””â”€ Firebase Console (é›²ç«¯èªè­‰)
```

### ç”Ÿç”¢ç’°å¢ƒï¼ˆå¯èƒ½çš„é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel (æ¨è–¦)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ éƒ¨ç½² Next.js                  â”‚
â”‚ â€¢ è‡ªå‹• CI/CD                    â”‚
â”‚ â€¢ ç’°å¢ƒè®Šæ•¸ç®¡ç†                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚
     â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Firebase â”‚    â”‚ PostgreSQL  â”‚
â”‚  Auth   â”‚    â”‚ (Supabaseç­‰)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€è¡“æ£§æ±ºç­–ç†ç”±

| é¸æ“‡ | ç†ç”± |
|------|------|
| **Next.js** | å…¨æ£§æ¡†æ¶ï¼Œå‰å¾Œç«¯çµ±ä¸€ |
| **Firebase Auth** | ä¼æ¥­ç´šå®‰å…¨èªè­‰ |
| **Prisma + SQLite** | é–‹ç™¼å¿«é€Ÿï¼Œç„¡éœ€é…ç½® |
| **Zustand** | è¼•é‡ç´šç‹€æ…‹ç®¡ç† |
| **Tailwind CSS** | å¿«é€Ÿ UI é–‹ç™¼ |

---

## ğŸ“ˆ æ“´å±•æ€§è€ƒé‡

### æœªä¾†å¯èƒ½çš„æ”¹é€²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Current (MVP)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Phone + Password              â”‚
â”‚ â€¢ Email + Password              â”‚
â”‚ â€¢ Google OAuth                  â”‚
â”‚ â€¢ Facebook OAuth                â”‚
â”‚ â€¢ SQLite                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼ (3 å€‹æœˆå¾Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Enhancement            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ LINE OAuth                    â”‚
â”‚ â€¢ å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½                  â”‚
â”‚ â€¢ äºŒå› ç´ èªè­‰ (2FA)              â”‚
â”‚ â€¢ é·ç§»åˆ° PostgreSQL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼ (6 å€‹æœˆå¾Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: Scale                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Redis å¿«å–                    â”‚
â”‚ â€¢ å¾®æœå‹™åŒ–                      â”‚
â”‚ â€¢ åœ‹éš›åŒ–                        â”‚
â”‚ â€¢ API Rate Limiting             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [éœ€æ±‚è¦æ ¼](./REQUIREMENTS.md)
- [API è¦æ ¼](./API_SPEC.md)
- [è³‡æ–™åº«è¨­è¨ˆ](./DATABASE_SCHEMA.md)
- [è¨è«–ç´€éŒ„](./DISCUSSION_NOTES.md)

---

_æ­¤æ–‡æª”åŸºæ–¼ 2025-11-18 çš„è¨è«–_
